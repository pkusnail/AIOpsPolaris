# AIOps Root Cause Analysis Patterns for LLM Training

## 📋 概述

本文档提取了10个真实incident案例中的根因分析模式，用于训练LLM进行自动化根因分析。通过学习这些模式，AI系统能够：

1. **识别故障症状**：从用户反馈和监控告警中识别问题
2. **追踪调用链**：理解服务依赖关系和影响范围  
3. **分析日志模式**：从时序日志中发现故障演进过程
4. **定位根本原因**：通过排除法找到真正的问题源头
5. **验证解决方案**：确认修复措施的有效性

---

## 🔍 根因分析通用方法论

### 基础分析框架

```
症状识别 → 影响范围 → 时间线分析 → 依赖排查 → 根因确定 → 解决验证
```

### 关键分析步骤

1. **症状收集**: 用户报告 + 监控告警 + 性能指标异常
2. **影响评估**: 哪些服务受影响？影响程度如何？
3. **调用链追踪**: 按照系统架构图追踪请求路径
4. **时间线建立**: 确定故障开始时间和演进过程
5. **假设验证**: 基于证据逐个排除可能原因
6. **根因确认**: 找到能解释所有症状的单一原因

---

## 📊 故障分类和诊断模式

### 1. 资源耗尽类故障

#### CPU过载模式 (Incident 001, 008)
**症状特征**:
- 服务响应时间急剧增加
- CPU使用率 > 90%
- 垃圾回收时间占比高
- 下游服务超时报错

**分析思路**:
```
高延迟报告 → 检查上游服务负载 → 发现CPU异常 → 分析CPU消耗原因
→ 检查代码变更 → 定位低效算法 → 验证修复效果
```

**根因模式**:
- 新部署代码包含低效算法
- 内存泄漏导致频繁GC
- 线程池配置不当

#### 内存问题模式 (Incident 003, 008)  
**症状特征**:
- JVM堆使用率持续上升
- OutOfMemoryError异常
- GC时间异常增长
- 服务重启或崩溃

**分析思路**:
```
OOM报错 → 堆内存分析 → 发现对象泄漏 → 追踪对象来源
→ 检查资源释放逻辑 → 修复泄漏点 → 验证内存稳定
```

#### 磁盘I/O瓶颈模式 (Incident 002, 007)
**症状特征**:
- I/O等待时间 > 80%
- 磁盘读写速度下降
- 服务响应变慢
- 日志写入异常

**分析思路**:
```
响应慢报告 → 检查系统资源 → 发现I/O异常 → 分析磁盘使用
→ 发现大文件或碎片 → 清理或优化 → 确认性能恢复
```

### 2. 配置错误类故障

#### 负载均衡异常模式 (Incident 006)
**症状特征**:
- 服务负载分布不均
- 部分服务过载，部分空闲
- 整体系统性能下降
- 流量路由异常

**分析思路**:
```
系统过载 → 检查各服务负载 → 发现分布异常 → 检查路由配置
→ 发现权重错误 → 修正配置 → 验证流量分布
```

#### 连接池配置问题 (Incident 005)
**症状特征**:
- 部分实例连接异常
- "Connection pool exhausted"错误
- 数据库查询超时
- 服务实例间性能不一致

**分析思路**:
```
连接错误 → 检查各实例状态 → 发现特定实例异常 → 检查连接配置
→ 分析长连接占用 → 调整池大小和超时 → 确认连接正常
```

### 3. 网络相关故障

#### 跨DC网络问题 (Incident 004, 010)
**症状特征**:
- 跨数据中心调用失败
- 网络超时或连接拒绝
- 部分调用链完全中断
- 网络延迟异常增加

**分析思路**:
```
跨DC失败 → 检查网络连通性 → 发现链路问题 → 联系网络团队
→ 确认硬件故障 → 等待修复或切换 → 验证连通性恢复
```

### 4. 外部依赖故障

#### 第三方API问题 (Incident 009)
**症状特征**:
- 特定调用链100%失败
- 外部API超时或错误
- 缺乏熔断机制
- 故障级联扩散

**分析思路**:
```
调用链失败 → 检查外部依赖 → 确认第三方问题 → 实施熔断
→ 启用降级模式 → 等待外部恢复 → 确认服务恢复
```

---

## 🤖 LLM训练Prompt模板

### 通用根因分析Prompt

```
你是一个专业的AIOps根因分析专家。请基于以下信息进行故障根因分析：

**系统架构**：
- 服务A（API网关）-> 服务B/C（业务逻辑）-> 服务D1/D2/D3/F（数据处理）
- 调用链：A->B->D* (60%) 和 A->C->F (40%)

**故障症状**：
[具体的用户报告和监控告警]

**相关日志**：  
[时序日志片段]

**系统指标**：
[CPU、内存、磁盘、网络等指标]

请按以下格式进行分析：

1. **症状总结**：描述主要故障表现
2. **影响范围**：确定受影响的服务和调用链
3. **时间线分析**：梳理故障发生和演进过程
4. **假设验证**：列出可能原因并逐一分析
5. **根本原因**：确定最终的故障根因
6. **解决方案**：提出具体的修复建议
7. **预防措施**：给出避免复发的建议
```

### 特定故障类型Prompt

#### CPU过载分析模板
```
分析以下CPU过载故障：

症状：服务响应时间从200ms增加到3-5秒，CPU使用率95%+

分析要点：
1. 检查CPU异常的具体服务
2. 分析CPU消耗的根本原因（代码vs配置vs负载）
3. 评估对下游服务的级联影响
4. 确定是否存在内存压力导致的GC问题
5. 追踪最近的代码或配置变更
```

#### 网络故障分析模板
```
分析以下网络连接故障：

症状：跨数据中心调用100%失败，连接超时

分析要点：
1. 确认网络连通性状态
2. 区分应用层vs网络层问题
3. 检查网络监控和ISP状态
4. 评估是否有备用路径
5. 分析故障对业务的完整影响
```

### 日志模式识别Prompt

```
从以下日志中识别故障模式：

**正常状态模式**：
- INFO级别日志占主导
- 响应时间在阈值内
- 资源使用率正常
- Health check通过

**故障征兆模式**：
- WARN日志增加
- 性能指标超过阈值
- 资源使用率上升
- 超时开始出现

**故障高峰模式**：
- ERROR/CRITICAL日志密集
- 服务不可用
- 资源耗尽
- 级联失败

**恢复阶段模式**：
- ERROR日志减少
- 性能指标恢复
- Health check恢复
- 正常日志恢复

请识别当前日志属于哪个阶段，并提取关键故障指标。
```

---

## 📈 根因分析成功标准

### 分析质量评估

1. **准确性**：根因分析是否指向真正的问题源头
2. **完整性**：是否考虑了所有相关因素和证据
3. **逻辑性**：分析推理过程是否合理连贯
4. **可操作性**：提出的解决方案是否具体可行
5. **预防性**：是否提供了避免复发的建议

### 关键成功因素

1. **全面的症状收集**：不遗漏任何相关信息
2. **系统化的分析方法**：按步骤有序推进
3. **证据驱动的推理**：基于事实而非猜测
4. **多角度的验证**：从不同维度确认结论
5. **持续的学习优化**：从每次分析中提升能力

---

## 🎯 训练数据使用指南

### 对于LLM训练

1. **输入格式标准化**：统一症状描述、日志格式、指标格式
2. **输出格式规范化**：统一分析结构和结论表达
3. **多样化场景覆盖**：包含各种故障类型和复杂度
4. **渐进式难度设计**：从简单到复杂的训练序列
5. **反馈循环建立**：根据分析结果调整训练重点

### 持续改进策略

1. **新故障模式积累**：持续收集新的故障案例
2. **分析准确性跟踪**：统计分析的准确率和改进趋势  
3. **模式更新迭代**：基于新数据更新分析模式
4. **专家知识融合**：结合人工专家的经验和反馈
5. **工具链优化**：改进数据收集和分析工具

通过这些模式和方法，LLM可以学习到专业的根因分析技能，在面对新的故障时能够进行系统化、逻辑化的分析，准确定位问题根因并提出有效的解决方案。